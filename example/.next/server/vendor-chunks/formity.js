"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/formity";
exports.ids = ["vendor-chunks/formity"];
exports.modules = {

/***/ "(ssr)/./node_modules/formity/dist/formity.esm.js":
/*!**************************************************!*\
  !*** ./node_modules/formity/dist/formity.esm.js ***!
  \**************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Formity: () => (/* binding */ Formity),\n/* harmony export */   useFormity: () => (/* binding */ useFormity)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"(ssr)/./node_modules/next/dist/server/future/route-modules/app-page/vendored/ssr/react.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var expry__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! expry */ \"(ssr)/./node_modules/expry/dist/expry.esm.js\");\n/* harmony import */ var mapsy__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! mapsy */ \"(ssr)/./node_modules/mapsy/dist/index.js\");\n/* harmony import */ var mapsy__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(mapsy__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\n\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _createForOfIteratorHelperLoose(r, e) {\n  var t = \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (t) return (t = t.call(r)).next.bind(t);\n  if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && \"number\" == typeof r.length) {\n    t && (r = t);\n    var o = 0;\n    return function () {\n      return o >= r.length ? {\n        done: !0\n      } : {\n        done: !1,\n        value: r[o++]\n      };\n    };\n  }\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _extends() {\n  return _extends = Object.assign ? Object.assign.bind() : function (n) {\n    for (var e = 1; e < arguments.length; e++) {\n      var t = arguments[e];\n      for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]);\n    }\n    return n;\n  }, _extends.apply(null, arguments);\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nvar ListSchemaUtils;\n(function (ListSchemaUtils) {\n  function is(schema) {\n    return Array.isArray(schema);\n  }\n  ListSchemaUtils.is = is;\n  function into(schema) {\n    if (schema.length > 0) return {\n      type: \"list\",\n      index: 0\n    };\n    return null;\n  }\n  ListSchemaUtils.into = into;\n  function next(schema, position) {\n    var index = position.index;\n    if (index < schema.length - 1) return {\n      type: \"list\",\n      index: index + 1\n    };\n    return null;\n  }\n  ListSchemaUtils.next = next;\n  function at(schema, position) {\n    var index = position.index;\n    return schema[index];\n  }\n  ListSchemaUtils.at = at;\n})(ListSchemaUtils || (ListSchemaUtils = {}));\n\nvar CondSchemaUtils;\n(function (CondSchemaUtils) {\n  function is(schema) {\n    return \"cond\" in schema;\n  }\n  CondSchemaUtils.is = is;\n  function into(schema, variables) {\n    if ((0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.cond[\"if\"], variables)) {\n      if (schema.cond.then.length > 0) {\n        return {\n          type: \"cond\",\n          branch: \"then\",\n          index: 0\n        };\n      }\n    } else {\n      if (schema.cond[\"else\"].length > 0) {\n        return {\n          type: \"cond\",\n          branch: \"else\",\n          index: 0\n        };\n      }\n    }\n    return null;\n  }\n  CondSchemaUtils.into = into;\n  function next(schema, position) {\n    var branch = position.branch,\n      index = position.index;\n    if (index < schema.cond[branch].length - 1) {\n      return {\n        type: \"cond\",\n        branch: branch,\n        index: index + 1\n      };\n    }\n    return null;\n  }\n  CondSchemaUtils.next = next;\n  function at(schema, position) {\n    var branch = position.branch,\n      index = position.index;\n    return schema.cond[branch][index];\n  }\n  CondSchemaUtils.at = at;\n})(CondSchemaUtils || (CondSchemaUtils = {}));\n\nvar LoopSchemaUtils;\n(function (LoopSchemaUtils) {\n  function is(schema) {\n    return \"loop\" in schema;\n  }\n  LoopSchemaUtils.is = is;\n  function into(schema, variables) {\n    if ((0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.loop[\"while\"], variables)) {\n      if (schema.loop[\"do\"].length > 0) return {\n        type: \"loop\",\n        index: 0\n      };\n    }\n    return null;\n  }\n  LoopSchemaUtils.into = into;\n  function next(schema, position, variables) {\n    var index = position.index;\n    if (index < schema.loop[\"do\"].length - 1) return {\n      type: \"loop\",\n      index: index + 1\n    };\n    if ((0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.loop[\"while\"], variables)) return {\n      type: \"loop\",\n      index: 0\n    };\n    return null;\n  }\n  LoopSchemaUtils.next = next;\n  function at(schema, position) {\n    var index = position.index;\n    return schema.loop[\"do\"][index];\n  }\n  LoopSchemaUtils.at = at;\n})(LoopSchemaUtils || (LoopSchemaUtils = {}));\n\nvar FlowSchemaUtils;\n(function (FlowSchemaUtils) {\n  function is(schema) {\n    return ListSchemaUtils.is(schema) || CondSchemaUtils.is(schema) || LoopSchemaUtils.is(schema);\n  }\n  FlowSchemaUtils.is = is;\n  function find(schema, path) {\n    var current = schema;\n    for (var _iterator = _createForOfIteratorHelperLoose(path), _step; !(_step = _iterator()).done;) {\n      var position = _step.value;\n      var flow = current;\n      current = at(flow, position);\n    }\n    return current;\n  }\n  FlowSchemaUtils.find = find;\n  function into(schema, variables) {\n    if (ListSchemaUtils.is(schema)) return ListSchemaUtils.into(schema);\n    if (CondSchemaUtils.is(schema)) return CondSchemaUtils.into(schema, variables);\n    if (LoopSchemaUtils.is(schema)) return LoopSchemaUtils.into(schema, variables);\n    throw new Error(\"Invalid schema\");\n  }\n  FlowSchemaUtils.into = into;\n  function next(schema, position, variables) {\n    if (ListSchemaUtils.is(schema)) return ListSchemaUtils.next(schema, position);\n    if (CondSchemaUtils.is(schema)) return CondSchemaUtils.next(schema, position);\n    if (LoopSchemaUtils.is(schema)) return LoopSchemaUtils.next(schema, position, variables);\n    throw new Error(\"Invalid schema\");\n  }\n  FlowSchemaUtils.next = next;\n  function at(schema, position) {\n    if (ListSchemaUtils.is(schema)) return ListSchemaUtils.at(schema, position);\n    if (CondSchemaUtils.is(schema)) return CondSchemaUtils.at(schema, position);\n    if (LoopSchemaUtils.is(schema)) return LoopSchemaUtils.at(schema, position);\n    throw new Error(\"Invalid schema\");\n  }\n})(FlowSchemaUtils || (FlowSchemaUtils = {}));\n\nvar FormSchemaUtils;\n(function (FormSchemaUtils) {\n  function is(schema) {\n    return \"form\" in schema;\n  }\n  FormSchemaUtils.is = is;\n  function keys(schema, variables) {\n    var defaultValues = (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.form.defaultValues, variables);\n    return function (name) {\n      return defaultValues[name][1];\n    };\n  }\n  FormSchemaUtils.keys = keys;\n  function result(schema, variables) {\n    return {\n      type: \"form\",\n      defaultValues: (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.form.defaultValues, variables),\n      resolver: (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.form.resolver, variables),\n      render: schema.form.render\n    };\n  }\n  FormSchemaUtils.result = result;\n})(FormSchemaUtils || (FormSchemaUtils = {}));\n\nvar VariablesSchemaUtils;\n(function (VariablesSchemaUtils) {\n  function is(schema) {\n    return \"variables\" in schema;\n  }\n  VariablesSchemaUtils.is = is;\n  function variables(schema, variables) {\n    return (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema.variables, variables);\n  }\n  VariablesSchemaUtils.variables = variables;\n})(VariablesSchemaUtils || (VariablesSchemaUtils = {}));\n\nvar FormFieldsUtils;\n(function (FormFieldsUtils) {\n  function get(form, name, keys, defaultValue) {\n    var current = form[name];\n    for (var _iterator = _createForOfIteratorHelperLoose(keys), _step; !(_step = _iterator()).done;) {\n      var key = _step.value;\n      if (key in current.keys) {\n        current = current.keys[key];\n      } else {\n        return defaultValue;\n      }\n    }\n    if (current.data === null) return defaultValue;\n    return current.data;\n  }\n  FormFieldsUtils.get = get;\n  function set(form, name, keys, data) {\n    var _extends2, _extends3;\n    var updated = name in form ? _extends({}, form, (_extends2 = {}, _extends2[name] = {\n      data: form[name].data,\n      keys: _extends({}, form[name].keys)\n    }, _extends2)) : _extends({}, form, (_extends3 = {}, _extends3[name] = {\n      data: null,\n      keys: {}\n    }, _extends3));\n    var current = updated[name];\n    for (var _iterator2 = _createForOfIteratorHelperLoose(keys), _step2; !(_step2 = _iterator2()).done;) {\n      var key = _step2.value;\n      if (key in current.keys) {\n        var _name = current.keys[key];\n        var copy = {\n          data: _name.data,\n          keys: _extends({}, _name.keys)\n        };\n        current.keys[key] = copy;\n        current = copy;\n      } else {\n        var _name2 = {\n          data: null,\n          keys: {}\n        };\n        current.keys[key] = _name2;\n        current = _name2;\n      }\n    }\n    current.data = data;\n    return updated;\n  }\n  FormFieldsUtils.set = set;\n})(FormFieldsUtils || (FormFieldsUtils = {}));\n\nvar ListFieldsUtils;\n(function (ListFieldsUtils) {\n  function clone(flow) {\n    return {\n      type: \"list\",\n      list: _extends({}, flow.list)\n    };\n  }\n  ListFieldsUtils.clone = clone;\n  function createFlow() {\n    return {\n      type: \"list\",\n      list: {}\n    };\n  }\n  ListFieldsUtils.createFlow = createFlow;\n  function getItem(flow, position) {\n    var index = position.index;\n    if (index in flow.list) return flow.list[index];\n    return null;\n  }\n  ListFieldsUtils.getItem = getItem;\n  function setItem(flow, position, item) {\n    var index = position.index;\n    flow.list[index] = item;\n  }\n  ListFieldsUtils.setItem = setItem;\n})(ListFieldsUtils || (ListFieldsUtils = {}));\n\nvar CondFieldsUtils;\n(function (CondFieldsUtils) {\n  function clone(flow) {\n    return {\n      type: \"cond\",\n      then: _extends({}, flow.then),\n      \"else\": _extends({}, flow[\"else\"])\n    };\n  }\n  CondFieldsUtils.clone = clone;\n  function createFlow() {\n    return {\n      type: \"cond\",\n      then: {},\n      \"else\": {}\n    };\n  }\n  CondFieldsUtils.createFlow = createFlow;\n  function getItem(flow, position) {\n    var branch = position.branch,\n      index = position.index;\n    if (branch in flow) {\n      if (index in flow[branch]) return flow[branch][index];\n    }\n    return null;\n  }\n  CondFieldsUtils.getItem = getItem;\n  function setItem(flow, position, value) {\n    var _flow$branch;\n    var branch = position.branch,\n      index = position.index;\n    if (branch in flow) flow[branch][index] = value;else flow[branch] = (_flow$branch = {}, _flow$branch[index] = value, _flow$branch);\n  }\n  CondFieldsUtils.setItem = setItem;\n})(CondFieldsUtils || (CondFieldsUtils = {}));\n\nvar LoopFieldsUtils;\n(function (LoopFieldsUtils) {\n  function clone(flow) {\n    return {\n      type: \"loop\",\n      list: _extends({}, flow.list)\n    };\n  }\n  LoopFieldsUtils.clone = clone;\n  function createFlow() {\n    return {\n      type: \"loop\",\n      list: {}\n    };\n  }\n  LoopFieldsUtils.createFlow = createFlow;\n  function getItem(flow, position) {\n    var index = position.index;\n    if (index in flow.list) return flow.list[index];\n    return null;\n  }\n  LoopFieldsUtils.getItem = getItem;\n  function setItem(flow, position, item) {\n    var index = position.index;\n    flow.list[index] = item;\n  }\n  LoopFieldsUtils.setItem = setItem;\n})(LoopFieldsUtils || (LoopFieldsUtils = {}));\n\nvar FlowFieldsUtils;\n(function (FlowFieldsUtils) {\n  function get(flow, path, name, keys, defaultValue) {\n    var current = flow;\n    for (var _iterator = _createForOfIteratorHelperLoose(path), _step; !(_step = _iterator()).done;) {\n      var position = _step.value;\n      var _flow = current;\n      var item = getItem(_flow, position);\n      if (item === null) return defaultValue;\n      current = item;\n    }\n    var form = current;\n    return FormFieldsUtils.get(form, name, keys, defaultValue);\n  }\n  FlowFieldsUtils.get = get;\n  function set(flow, path, name, keys, value) {\n    var updated = clone(flow);\n    var current = updated;\n    for (var i = 0; i < path.length - 1; i++) {\n      var _position = path[i];\n      var _item = getItem(current, _position);\n      if (_item) {\n        var next = _item;\n        var cloned = clone(next);\n        setItem(current, _position, cloned);\n        current = cloned;\n      } else {\n        var _next = createFlow(path[i + 1]);\n        setItem(current, _position, _next);\n        current = _next;\n      }\n    }\n    var position = path[path.length - 1];\n    var item = getItem(current, position);\n    if (item) {\n      var form = item;\n      setItem(current, position, FormFieldsUtils.set(form, name, keys, value));\n    } else {\n      var _form2;\n      var _form = (_form2 = {}, _form2[name] = {\n        data: null,\n        keys: {}\n      }, _form2);\n      setItem(current, position, FormFieldsUtils.set(_form, name, keys, value));\n    }\n    return updated;\n  }\n  FlowFieldsUtils.set = set;\n  var clone = /*#__PURE__*/(0,mapsy__WEBPACK_IMPORTED_MODULE_2__.mapsy)([], [\"type\"], {\n    list: ListFieldsUtils.clone,\n    cond: CondFieldsUtils.clone,\n    loop: LoopFieldsUtils.clone\n  });\n  var createFlow = /*#__PURE__*/(0,mapsy__WEBPACK_IMPORTED_MODULE_2__.mapsy)([], [\"type\"], {\n    list: ListFieldsUtils.createFlow,\n    cond: CondFieldsUtils.createFlow,\n    loop: LoopFieldsUtils.createFlow\n  });\n  var getItem = /*#__PURE__*/(0,mapsy__WEBPACK_IMPORTED_MODULE_2__.mapsy)([], [\"type\"], {\n    list: ListFieldsUtils.getItem,\n    cond: CondFieldsUtils.getItem,\n    loop: LoopFieldsUtils.getItem\n  });\n  var setItem = /*#__PURE__*/(0,mapsy__WEBPACK_IMPORTED_MODULE_2__.mapsy)([], [\"type\"], {\n    list: ListFieldsUtils.setItem,\n    cond: CondFieldsUtils.setItem,\n    loop: LoopFieldsUtils.setItem\n  });\n})(FlowFieldsUtils || (FlowFieldsUtils = {}));\n\nvar Controller = /*#__PURE__*/function () {\n  function Controller(schema) {\n    this.schema = schema;\n  }\n  var _proto = Controller.prototype;\n  _proto.initial = function initial(variables) {\n    if (variables === void 0) {\n      variables = {};\n    }\n    var path = this.initialPath();\n    var stop = this.nearestStopPoint({\n      path: path,\n      variables: variables\n    });\n    var fields = {\n      type: \"list\",\n      list: {}\n    };\n    return {\n      points: [stop],\n      fields: fields\n    };\n  };\n  _proto.initialPath = function initialPath() {\n    var path = this.initialPathSchema(this.schema);\n    if (path) return path;\n    throw new Error(\"The schema is malformed\");\n  };\n  _proto.initialPathSchema = function initialPathSchema(schema) {\n    var position = FlowSchemaUtils.into(schema, {});\n    while (position) {\n      var path = this.initialPathPosition(schema, position);\n      if (path) return path;\n      position = FlowSchemaUtils.next(schema, position, {});\n    }\n    return null;\n  };\n  _proto.initialPathPosition = function initialPathPosition(schema, position) {\n    var item = FlowSchemaUtils.find(schema, [position]);\n    if (FlowSchemaUtils.is(item)) {\n      var path = this.initialPathSchema(item);\n      if (path) return [position].concat(path);else return null;\n    }\n    return [position];\n  };\n  _proto.nearestStopPoint = function nearestStopPoint(point) {\n    var current = point;\n    while (VariablesSchemaUtils.is(FlowSchemaUtils.find(this.schema, current.path))) {\n      var schema = FlowSchemaUtils.find(this.schema, current.path);\n      var variables = VariablesSchemaUtils.variables(schema, current.variables);\n      current = {\n        path: current.path,\n        variables: _extends({}, current.variables, variables)\n      };\n      current = this.nextPoint(current);\n    }\n    return current;\n  };\n  _proto.nextPoint = function nextPoint(point) {\n    var selected = this.nextFlowPoint(point);\n    if (selected) return selected;\n    return this.nextPoint(this.parentPoint(point));\n  };\n  _proto.nextFlowPoint = function nextFlowPoint(point) {\n    var next = this.nextFlowPointNext(point);\n    if (next) {\n      var into = this.nextFlowPointInto(next);\n      if (into) return into;\n      return this.nextFlowPoint(next);\n    }\n    return null;\n  };\n  _proto.nextFlowPointNext = function nextFlowPointNext(point) {\n    var flow = FlowSchemaUtils.find(this.schema, point.path.slice(0, -1));\n    var position = FlowSchemaUtils.next(flow, point.path[point.path.length - 1], point.variables);\n    if (position) {\n      var path = [].concat(point.path.slice(0, -1), [position]);\n      return {\n        path: path,\n        variables: point.variables\n      };\n    }\n    return null;\n  };\n  _proto.nextFlowPointInto = function nextFlowPointInto(point) {\n    var item = FlowSchemaUtils.find(this.schema, point.path);\n    if (FlowSchemaUtils.is(item)) {\n      var position = FlowSchemaUtils.into(item, point.variables);\n      if (position) {\n        var path = [].concat(point.path, [position]);\n        var next = {\n          path: path,\n          variables: point.variables\n        };\n        var into = this.nextFlowPointInto(next);\n        if (into) return into;\n        return this.nextFlowPoint(next);\n      }\n      return null;\n    }\n    return point;\n  };\n  _proto.parentPoint = function parentPoint(point) {\n    if (point.path.length > 1) return {\n      path: point.path.slice(0, -1),\n      variables: point.variables\n    };\n    throw new Error(\"The schema is malformed\");\n  };\n  _proto.next = function next(flow, formData) {\n    var fields = this.updateFields(flow, formData);\n    return this.navigateNext(flow, fields, formData);\n  };\n  _proto.updateFields = function updateFields(flow, formData) {\n    var stop = flow.points[flow.points.length - 1];\n    var form = FlowSchemaUtils.find(this.schema, stop.path);\n    var keys = FormSchemaUtils.keys(form, stop.variables);\n    var fields = flow.fields;\n    for (var _i = 0, _Object$entries = Object.entries(formData); _i < _Object$entries.length; _i++) {\n      var _Object$entries$_i = _Object$entries[_i],\n        name = _Object$entries$_i[0],\n        value = _Object$entries$_i[1];\n      fields = FlowFieldsUtils.set(fields, stop.path, name, keys(name), value);\n    }\n    return fields;\n  };\n  _proto.navigateNext = function navigateNext(flow, fields, formData) {\n    var last = flow.points[flow.points.length - 1];\n    var vars = _extends({}, last.variables, formData);\n    var next = this.nearestStopPoint(this.nextPoint({\n      path: last.path,\n      variables: vars\n    }));\n    return {\n      points: [].concat(flow.points, [next]),\n      fields: fields\n    };\n  };\n  _proto.previous = function previous(flow, formData) {\n    var fields = this.updateFields(flow, formData);\n    return this.navigatePrevious(flow, fields);\n  };\n  _proto.navigatePrevious = function navigatePrevious(flow, fields) {\n    var prev = flow.points.slice(0, -1);\n    return {\n      points: prev,\n      fields: fields\n    };\n  };\n  return Controller;\n}();\n\nfunction useDefaultValues(form, path, fields) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return Object.fromEntries(Object.entries(form.defaultValues).map(function (_ref) {\n      var name = _ref[0],\n        _ref$ = _ref[1],\n        value = _ref$[0],\n        keys = _ref$[1];\n      return [name, FlowFieldsUtils.get(fields, path, name, keys, value)];\n    }));\n  }, [form, path, fields]);\n}\n\nfunction useResolver(form) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return function (values) {\n      var errors = {};\n      for (var _i = 0, _Object$entries = Object.entries(form.resolver); _i < _Object$entries.length; _i++) {\n        var _Object$entries$_i = _Object$entries[_i],\n          name = _Object$entries$_i[0],\n          validations = _Object$entries$_i[1];\n        var error = validations.find(function (_ref) {\n          var expr = _ref[0];\n          return !(0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(expr, values);\n        });\n        if (error) errors[name] = {\n          type: \"validation\",\n          message: error[1]\n        };\n      }\n      return {\n        values: values,\n        errors: errors\n      };\n    };\n  }, [form]);\n}\n\nfunction useRender(form, variables, components) {\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    var callback = function callback(value) {\n      var object = value;\n      var _Object$keys = Object.keys(object),\n        key = _Object$keys[0];\n      var component = components[key];\n      var values = object[key];\n      return component(values, callback);\n    };\n    return function (values) {\n      var render = (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(form.render, _extends({}, variables, values));\n      return callback(render);\n    };\n  }, [form, variables, components]);\n}\n\nvar FormityContext = /*#__PURE__*/(0,react__WEBPACK_IMPORTED_MODULE_0__.createContext)(null);\nfunction useFormity() {\n  var context = (0,react__WEBPACK_IMPORTED_MODULE_0__.useContext)(FormityContext);\n  if (!context) throw new Error(\"useFormity must be used within Formity\");\n  return context;\n}\n\nvar ReturnSchemaUtils;\n(function (ReturnSchemaUtils) {\n  function is(schema) {\n    return \"return\" in schema;\n  }\n  ReturnSchemaUtils.is = is;\n  function result(schema, variables) {\n    return {\n      type: \"return\",\n      \"return\": (0,expry__WEBPACK_IMPORTED_MODULE_1__.expry)(schema[\"return\"], variables)\n    };\n  }\n  ReturnSchemaUtils.result = result;\n})(ReturnSchemaUtils || (ReturnSchemaUtils = {}));\n\nvar StepSchemaUtils;\n(function (StepSchemaUtils) {\n  function is(schema) {\n    return FormSchemaUtils.is(schema) || ReturnSchemaUtils.is(schema);\n  }\n  StepSchemaUtils.is = is;\n  function result(schema, variables) {\n    if (FormSchemaUtils.is(schema)) return FormSchemaUtils.result(schema, variables);\n    if (ReturnSchemaUtils.is(schema)) return ReturnSchemaUtils.result(schema, variables);\n    throw new Error(\"Invalid schema\");\n  }\n  StepSchemaUtils.result = result;\n})(StepSchemaUtils || (StepSchemaUtils = {}));\n\nvar FlowUtils;\n(function (FlowUtils) {\n  function getResult(flow, schema) {\n    var _flow$points = flow.points[flow.points.length - 1],\n      path = _flow$points.path,\n      variables = _flow$points.variables;\n    var nested = FlowSchemaUtils.find(schema, path);\n    return StepSchemaUtils.result(nested, variables);\n  }\n  FlowUtils.getResult = getResult;\n  function getFlow(flow, schema, formData) {\n    var stop = flow.points[flow.points.length - 1];\n    var path = stop.path;\n    var variables = stop.variables;\n    var form = FlowSchemaUtils.find(schema, path);\n    var keys = FormSchemaUtils.keys(form, variables);\n    var fields = flow.fields;\n    for (var _i = 0, _Object$entries = Object.entries(formData); _i < _Object$entries.length; _i++) {\n      var _Object$entries$_i = _Object$entries[_i],\n        name = _Object$entries$_i[0],\n        value = _Object$entries$_i[1];\n      fields = FlowFieldsUtils.set(fields, path, name, keys(name), value);\n    }\n    return _extends({}, flow, {\n      fields: fields\n    });\n  }\n  FlowUtils.getFlow = getFlow;\n})(FlowUtils || (FlowUtils = {}));\n\nfunction Formity(_ref) {\n  var components = _ref.components,\n    variables = _ref.variables,\n    schema = _ref.schema,\n    onReturn = _ref.onReturn,\n    initialFlow = _ref.initialFlow;\n  var controller = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return new Controller(schema);\n  }, [schema]);\n  var _useState = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(function () {\n      if (initialFlow) return initialFlow;\n      return controller.initial(variables);\n    }),\n    flow = _useState[0],\n    setFlow = _useState[1];\n  var form = FlowUtils.getResult(flow, schema);\n  var handleNext = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (formData) {\n    var next = controller.next(flow, formData);\n    var result = FlowUtils.getResult(next, schema);\n    if (result.type === \"return\") onReturn(result[\"return\"], _extends({}, flow, {\n      fields: next.fields\n    }));else setFlow(next);\n  }, [controller, flow, onReturn]);\n  var handleBack = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (formData) {\n    var previous = controller.previous(flow, formData);\n    setFlow(previous);\n  }, [controller, flow]);\n  var getFlow = (0,react__WEBPACK_IMPORTED_MODULE_0__.useCallback)(function (formData) {\n    return FlowUtils.getFlow(flow, schema, formData);\n  }, [flow, schema]);\n  var point = flow.points[flow.points.length - 1];\n  var defaultValues = useDefaultValues(form, point.path, flow.fields);\n  var resolver = useResolver(form);\n  var render = useRender(form, point.variables, components);\n  var values = (0,react__WEBPACK_IMPORTED_MODULE_0__.useMemo)(function () {\n    return {\n      step: flow.points.length,\n      defaultValues: defaultValues,\n      resolver: resolver,\n      onNext: handleNext,\n      onBack: handleBack,\n      getFlow: getFlow\n    };\n  }, [flow.points.length, defaultValues, resolver, handleNext, handleBack, getFlow]);\n  return (0,react__WEBPACK_IMPORTED_MODULE_0__.createElement)(FormityContext.Provider, {\n    value: values\n  }, render(values));\n}\n\n\n//# sourceMappingURL=formity.esm.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvZm9ybWl0eS9kaXN0L2Zvcm1pdHkuZXNtLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBaUc7QUFDbkU7QUFDQTs7QUFFOUI7QUFDQTtBQUNBLGdDQUFnQyxPQUFPO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRO0FBQ1I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0JBQW9CLHNCQUFzQjtBQUMxQztBQUNBLDBCQUEwQjtBQUMxQjtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsY0FBYztBQUNkO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMsMENBQTBDOztBQUUzQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFFBQVEsNENBQUs7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLDBDQUEwQzs7QUFFM0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxRQUFRLDRDQUFLO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUFDQSxtQkFBbUIsOENBQU87QUFDMUI7QUFDQSxHQUFHO0FBQ0gsa0JBQWtCLCtDQUFRO0FBQzFCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsbUJBQW1CLGtEQUFXO0FBQzlCO0FBQ0E7QUFDQSx3RUFBd0U7QUFDeEU7QUFDQSxLQUFLLEdBQUc7QUFDUixHQUFHO0FBQ0gsbUJBQW1CLGtEQUFXO0FBQzlCO0FBQ0E7QUFDQSxHQUFHO0FBQ0gsZ0JBQWdCLGtEQUFXO0FBQzNCO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZUFBZSw4Q0FBTztBQUN0QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILFNBQVMsb0RBQWE7QUFDdEI7QUFDQSxHQUFHO0FBQ0g7O0FBRStCO0FBQy9CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vZm9ybWl0eS10ZW1wbGF0ZS8uL25vZGVfbW9kdWxlcy9mb3JtaXR5L2Rpc3QvZm9ybWl0eS5lc20uanM/ZWMzNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VNZW1vLCB1c2VDb250ZXh0LCBjcmVhdGVDb250ZXh0LCB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2ssIGNyZWF0ZUVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBleHByeSB9IGZyb20gJ2V4cHJ5JztcbmltcG9ydCB7IG1hcHN5IH0gZnJvbSAnbWFwc3knO1xuXG5mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShyLCBhKSB7XG4gIChudWxsID09IGEgfHwgYSA+IHIubGVuZ3RoKSAmJiAoYSA9IHIubGVuZ3RoKTtcbiAgZm9yICh2YXIgZSA9IDAsIG4gPSBBcnJheShhKTsgZSA8IGE7IGUrKykgbltlXSA9IHJbZV07XG4gIHJldHVybiBuO1xufVxuZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXJMb29zZShyLCBlKSB7XG4gIHZhciB0ID0gXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgU3ltYm9sICYmIHJbU3ltYm9sLml0ZXJhdG9yXSB8fCByW1wiQEBpdGVyYXRvclwiXTtcbiAgaWYgKHQpIHJldHVybiAodCA9IHQuY2FsbChyKSkubmV4dC5iaW5kKHQpO1xuICBpZiAoQXJyYXkuaXNBcnJheShyKSB8fCAodCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShyKSkgfHwgZSAmJiByICYmIFwibnVtYmVyXCIgPT0gdHlwZW9mIHIubGVuZ3RoKSB7XG4gICAgdCAmJiAociA9IHQpO1xuICAgIHZhciBvID0gMDtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIG8gPj0gci5sZW5ndGggPyB7XG4gICAgICAgIGRvbmU6ICEwXG4gICAgICB9IDoge1xuICAgICAgICBkb25lOiAhMSxcbiAgICAgICAgdmFsdWU6IHJbbysrXVxuICAgICAgfTtcbiAgICB9O1xuICB9XG4gIHRocm93IG5ldyBUeXBlRXJyb3IoXCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTtcbn1cbmZ1bmN0aW9uIF9leHRlbmRzKCkge1xuICByZXR1cm4gX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAobikge1xuICAgIGZvciAodmFyIGUgPSAxOyBlIDwgYXJndW1lbnRzLmxlbmd0aDsgZSsrKSB7XG4gICAgICB2YXIgdCA9IGFyZ3VtZW50c1tlXTtcbiAgICAgIGZvciAodmFyIHIgaW4gdCkgKHt9KS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHQsIHIpICYmIChuW3JdID0gdFtyXSk7XG4gICAgfVxuICAgIHJldHVybiBuO1xuICB9LCBfZXh0ZW5kcy5hcHBseShudWxsLCBhcmd1bWVudHMpO1xufVxuZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KHIsIGEpIHtcbiAgaWYgKHIpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgcikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KHIsIGEpO1xuICAgIHZhciB0ID0ge30udG9TdHJpbmcuY2FsbChyKS5zbGljZSg4LCAtMSk7XG4gICAgcmV0dXJuIFwiT2JqZWN0XCIgPT09IHQgJiYgci5jb25zdHJ1Y3RvciAmJiAodCA9IHIuY29uc3RydWN0b3IubmFtZSksIFwiTWFwXCIgPT09IHQgfHwgXCJTZXRcIiA9PT0gdCA/IEFycmF5LmZyb20ocikgOiBcIkFyZ3VtZW50c1wiID09PSB0IHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KHQpID8gX2FycmF5TGlrZVRvQXJyYXkociwgYSkgOiB2b2lkIDA7XG4gIH1cbn1cblxudmFyIExpc3RTY2hlbWFVdGlscztcbihmdW5jdGlvbiAoTGlzdFNjaGVtYVV0aWxzKSB7XG4gIGZ1bmN0aW9uIGlzKHNjaGVtYSkge1xuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHNjaGVtYSk7XG4gIH1cbiAgTGlzdFNjaGVtYVV0aWxzLmlzID0gaXM7XG4gIGZ1bmN0aW9uIGludG8oc2NoZW1hKSB7XG4gICAgaWYgKHNjaGVtYS5sZW5ndGggPiAwKSByZXR1cm4ge1xuICAgICAgdHlwZTogXCJsaXN0XCIsXG4gICAgICBpbmRleDogMFxuICAgIH07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgTGlzdFNjaGVtYVV0aWxzLmludG8gPSBpbnRvO1xuICBmdW5jdGlvbiBuZXh0KHNjaGVtYSwgcG9zaXRpb24pIHtcbiAgICB2YXIgaW5kZXggPSBwb3NpdGlvbi5pbmRleDtcbiAgICBpZiAoaW5kZXggPCBzY2hlbWEubGVuZ3RoIC0gMSkgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwibGlzdFwiLFxuICAgICAgaW5kZXg6IGluZGV4ICsgMVxuICAgIH07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgTGlzdFNjaGVtYVV0aWxzLm5leHQgPSBuZXh0O1xuICBmdW5jdGlvbiBhdChzY2hlbWEsIHBvc2l0aW9uKSB7XG4gICAgdmFyIGluZGV4ID0gcG9zaXRpb24uaW5kZXg7XG4gICAgcmV0dXJuIHNjaGVtYVtpbmRleF07XG4gIH1cbiAgTGlzdFNjaGVtYVV0aWxzLmF0ID0gYXQ7XG59KShMaXN0U2NoZW1hVXRpbHMgfHwgKExpc3RTY2hlbWFVdGlscyA9IHt9KSk7XG5cbnZhciBDb25kU2NoZW1hVXRpbHM7XG4oZnVuY3Rpb24gKENvbmRTY2hlbWFVdGlscykge1xuICBmdW5jdGlvbiBpcyhzY2hlbWEpIHtcbiAgICByZXR1cm4gXCJjb25kXCIgaW4gc2NoZW1hO1xuICB9XG4gIENvbmRTY2hlbWFVdGlscy5pcyA9IGlzO1xuICBmdW5jdGlvbiBpbnRvKHNjaGVtYSwgdmFyaWFibGVzKSB7XG4gICAgaWYgKGV4cHJ5KHNjaGVtYS5jb25kW1wiaWZcIl0sIHZhcmlhYmxlcykpIHtcbiAgICAgIGlmIChzY2hlbWEuY29uZC50aGVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0eXBlOiBcImNvbmRcIixcbiAgICAgICAgICBicmFuY2g6IFwidGhlblwiLFxuICAgICAgICAgIGluZGV4OiAwXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2hlbWEuY29uZFtcImVsc2VcIl0ubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6IFwiY29uZFwiLFxuICAgICAgICAgIGJyYW5jaDogXCJlbHNlXCIsXG4gICAgICAgICAgaW5kZXg6IDBcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgQ29uZFNjaGVtYVV0aWxzLmludG8gPSBpbnRvO1xuICBmdW5jdGlvbiBuZXh0KHNjaGVtYSwgcG9zaXRpb24pIHtcbiAgICB2YXIgYnJhbmNoID0gcG9zaXRpb24uYnJhbmNoLFxuICAgICAgaW5kZXggPSBwb3NpdGlvbi5pbmRleDtcbiAgICBpZiAoaW5kZXggPCBzY2hlbWEuY29uZFticmFuY2hdLmxlbmd0aCAtIDEpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHR5cGU6IFwiY29uZFwiLFxuICAgICAgICBicmFuY2g6IGJyYW5jaCxcbiAgICAgICAgaW5kZXg6IGluZGV4ICsgMVxuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgQ29uZFNjaGVtYVV0aWxzLm5leHQgPSBuZXh0O1xuICBmdW5jdGlvbiBhdChzY2hlbWEsIHBvc2l0aW9uKSB7XG4gICAgdmFyIGJyYW5jaCA9IHBvc2l0aW9uLmJyYW5jaCxcbiAgICAgIGluZGV4ID0gcG9zaXRpb24uaW5kZXg7XG4gICAgcmV0dXJuIHNjaGVtYS5jb25kW2JyYW5jaF1baW5kZXhdO1xuICB9XG4gIENvbmRTY2hlbWFVdGlscy5hdCA9IGF0O1xufSkoQ29uZFNjaGVtYVV0aWxzIHx8IChDb25kU2NoZW1hVXRpbHMgPSB7fSkpO1xuXG52YXIgTG9vcFNjaGVtYVV0aWxzO1xuKGZ1bmN0aW9uIChMb29wU2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIFwibG9vcFwiIGluIHNjaGVtYTtcbiAgfVxuICBMb29wU2NoZW1hVXRpbHMuaXMgPSBpcztcbiAgZnVuY3Rpb24gaW50byhzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIGlmIChleHByeShzY2hlbWEubG9vcFtcIndoaWxlXCJdLCB2YXJpYWJsZXMpKSB7XG4gICAgICBpZiAoc2NoZW1hLmxvb3BbXCJkb1wiXS5sZW5ndGggPiAwKSByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImxvb3BcIixcbiAgICAgICAgaW5kZXg6IDBcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIExvb3BTY2hlbWFVdGlscy5pbnRvID0gaW50bztcbiAgZnVuY3Rpb24gbmV4dChzY2hlbWEsIHBvc2l0aW9uLCB2YXJpYWJsZXMpIHtcbiAgICB2YXIgaW5kZXggPSBwb3NpdGlvbi5pbmRleDtcbiAgICBpZiAoaW5kZXggPCBzY2hlbWEubG9vcFtcImRvXCJdLmxlbmd0aCAtIDEpIHJldHVybiB7XG4gICAgICB0eXBlOiBcImxvb3BcIixcbiAgICAgIGluZGV4OiBpbmRleCArIDFcbiAgICB9O1xuICAgIGlmIChleHByeShzY2hlbWEubG9vcFtcIndoaWxlXCJdLCB2YXJpYWJsZXMpKSByZXR1cm4ge1xuICAgICAgdHlwZTogXCJsb29wXCIsXG4gICAgICBpbmRleDogMFxuICAgIH07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgTG9vcFNjaGVtYVV0aWxzLm5leHQgPSBuZXh0O1xuICBmdW5jdGlvbiBhdChzY2hlbWEsIHBvc2l0aW9uKSB7XG4gICAgdmFyIGluZGV4ID0gcG9zaXRpb24uaW5kZXg7XG4gICAgcmV0dXJuIHNjaGVtYS5sb29wW1wiZG9cIl1baW5kZXhdO1xuICB9XG4gIExvb3BTY2hlbWFVdGlscy5hdCA9IGF0O1xufSkoTG9vcFNjaGVtYVV0aWxzIHx8IChMb29wU2NoZW1hVXRpbHMgPSB7fSkpO1xuXG52YXIgRmxvd1NjaGVtYVV0aWxzO1xuKGZ1bmN0aW9uIChGbG93U2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIExpc3RTY2hlbWFVdGlscy5pcyhzY2hlbWEpIHx8IENvbmRTY2hlbWFVdGlscy5pcyhzY2hlbWEpIHx8IExvb3BTY2hlbWFVdGlscy5pcyhzY2hlbWEpO1xuICB9XG4gIEZsb3dTY2hlbWFVdGlscy5pcyA9IGlzO1xuICBmdW5jdGlvbiBmaW5kKHNjaGVtYSwgcGF0aCkge1xuICAgIHZhciBjdXJyZW50ID0gc2NoZW1hO1xuICAgIGZvciAodmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2UocGF0aCksIF9zdGVwOyAhKF9zdGVwID0gX2l0ZXJhdG9yKCkpLmRvbmU7KSB7XG4gICAgICB2YXIgcG9zaXRpb24gPSBfc3RlcC52YWx1ZTtcbiAgICAgIHZhciBmbG93ID0gY3VycmVudDtcbiAgICAgIGN1cnJlbnQgPSBhdChmbG93LCBwb3NpdGlvbik7XG4gICAgfVxuICAgIHJldHVybiBjdXJyZW50O1xuICB9XG4gIEZsb3dTY2hlbWFVdGlscy5maW5kID0gZmluZDtcbiAgZnVuY3Rpb24gaW50byhzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIGlmIChMaXN0U2NoZW1hVXRpbHMuaXMoc2NoZW1hKSkgcmV0dXJuIExpc3RTY2hlbWFVdGlscy5pbnRvKHNjaGVtYSk7XG4gICAgaWYgKENvbmRTY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gQ29uZFNjaGVtYVV0aWxzLmludG8oc2NoZW1hLCB2YXJpYWJsZXMpO1xuICAgIGlmIChMb29wU2NoZW1hVXRpbHMuaXMoc2NoZW1hKSkgcmV0dXJuIExvb3BTY2hlbWFVdGlscy5pbnRvKHNjaGVtYSwgdmFyaWFibGVzKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNjaGVtYVwiKTtcbiAgfVxuICBGbG93U2NoZW1hVXRpbHMuaW50byA9IGludG87XG4gIGZ1bmN0aW9uIG5leHQoc2NoZW1hLCBwb3NpdGlvbiwgdmFyaWFibGVzKSB7XG4gICAgaWYgKExpc3RTY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gTGlzdFNjaGVtYVV0aWxzLm5leHQoc2NoZW1hLCBwb3NpdGlvbik7XG4gICAgaWYgKENvbmRTY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gQ29uZFNjaGVtYVV0aWxzLm5leHQoc2NoZW1hLCBwb3NpdGlvbik7XG4gICAgaWYgKExvb3BTY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gTG9vcFNjaGVtYVV0aWxzLm5leHQoc2NoZW1hLCBwb3NpdGlvbiwgdmFyaWFibGVzKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNjaGVtYVwiKTtcbiAgfVxuICBGbG93U2NoZW1hVXRpbHMubmV4dCA9IG5leHQ7XG4gIGZ1bmN0aW9uIGF0KHNjaGVtYSwgcG9zaXRpb24pIHtcbiAgICBpZiAoTGlzdFNjaGVtYVV0aWxzLmlzKHNjaGVtYSkpIHJldHVybiBMaXN0U2NoZW1hVXRpbHMuYXQoc2NoZW1hLCBwb3NpdGlvbik7XG4gICAgaWYgKENvbmRTY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gQ29uZFNjaGVtYVV0aWxzLmF0KHNjaGVtYSwgcG9zaXRpb24pO1xuICAgIGlmIChMb29wU2NoZW1hVXRpbHMuaXMoc2NoZW1hKSkgcmV0dXJuIExvb3BTY2hlbWFVdGlscy5hdChzY2hlbWEsIHBvc2l0aW9uKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNjaGVtYVwiKTtcbiAgfVxufSkoRmxvd1NjaGVtYVV0aWxzIHx8IChGbG93U2NoZW1hVXRpbHMgPSB7fSkpO1xuXG52YXIgRm9ybVNjaGVtYVV0aWxzO1xuKGZ1bmN0aW9uIChGb3JtU2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIFwiZm9ybVwiIGluIHNjaGVtYTtcbiAgfVxuICBGb3JtU2NoZW1hVXRpbHMuaXMgPSBpcztcbiAgZnVuY3Rpb24ga2V5cyhzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIHZhciBkZWZhdWx0VmFsdWVzID0gZXhwcnkoc2NoZW1hLmZvcm0uZGVmYXVsdFZhbHVlcywgdmFyaWFibGVzKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgIHJldHVybiBkZWZhdWx0VmFsdWVzW25hbWVdWzFdO1xuICAgIH07XG4gIH1cbiAgRm9ybVNjaGVtYVV0aWxzLmtleXMgPSBrZXlzO1xuICBmdW5jdGlvbiByZXN1bHQoc2NoZW1hLCB2YXJpYWJsZXMpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJmb3JtXCIsXG4gICAgICBkZWZhdWx0VmFsdWVzOiBleHByeShzY2hlbWEuZm9ybS5kZWZhdWx0VmFsdWVzLCB2YXJpYWJsZXMpLFxuICAgICAgcmVzb2x2ZXI6IGV4cHJ5KHNjaGVtYS5mb3JtLnJlc29sdmVyLCB2YXJpYWJsZXMpLFxuICAgICAgcmVuZGVyOiBzY2hlbWEuZm9ybS5yZW5kZXJcbiAgICB9O1xuICB9XG4gIEZvcm1TY2hlbWFVdGlscy5yZXN1bHQgPSByZXN1bHQ7XG59KShGb3JtU2NoZW1hVXRpbHMgfHwgKEZvcm1TY2hlbWFVdGlscyA9IHt9KSk7XG5cbnZhciBWYXJpYWJsZXNTY2hlbWFVdGlscztcbihmdW5jdGlvbiAoVmFyaWFibGVzU2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIFwidmFyaWFibGVzXCIgaW4gc2NoZW1hO1xuICB9XG4gIFZhcmlhYmxlc1NjaGVtYVV0aWxzLmlzID0gaXM7XG4gIGZ1bmN0aW9uIHZhcmlhYmxlcyhzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIHJldHVybiBleHByeShzY2hlbWEudmFyaWFibGVzLCB2YXJpYWJsZXMpO1xuICB9XG4gIFZhcmlhYmxlc1NjaGVtYVV0aWxzLnZhcmlhYmxlcyA9IHZhcmlhYmxlcztcbn0pKFZhcmlhYmxlc1NjaGVtYVV0aWxzIHx8IChWYXJpYWJsZXNTY2hlbWFVdGlscyA9IHt9KSk7XG5cbnZhciBGb3JtRmllbGRzVXRpbHM7XG4oZnVuY3Rpb24gKEZvcm1GaWVsZHNVdGlscykge1xuICBmdW5jdGlvbiBnZXQoZm9ybSwgbmFtZSwga2V5cywgZGVmYXVsdFZhbHVlKSB7XG4gICAgdmFyIGN1cnJlbnQgPSBmb3JtW25hbWVdO1xuICAgIGZvciAodmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyTG9vc2Uoa2V5cyksIF9zdGVwOyAhKF9zdGVwID0gX2l0ZXJhdG9yKCkpLmRvbmU7KSB7XG4gICAgICB2YXIga2V5ID0gX3N0ZXAudmFsdWU7XG4gICAgICBpZiAoa2V5IGluIGN1cnJlbnQua2V5cykge1xuICAgICAgICBjdXJyZW50ID0gY3VycmVudC5rZXlzW2tleV07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoY3VycmVudC5kYXRhID09PSBudWxsKSByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICAgIHJldHVybiBjdXJyZW50LmRhdGE7XG4gIH1cbiAgRm9ybUZpZWxkc1V0aWxzLmdldCA9IGdldDtcbiAgZnVuY3Rpb24gc2V0KGZvcm0sIG5hbWUsIGtleXMsIGRhdGEpIHtcbiAgICB2YXIgX2V4dGVuZHMyLCBfZXh0ZW5kczM7XG4gICAgdmFyIHVwZGF0ZWQgPSBuYW1lIGluIGZvcm0gPyBfZXh0ZW5kcyh7fSwgZm9ybSwgKF9leHRlbmRzMiA9IHt9LCBfZXh0ZW5kczJbbmFtZV0gPSB7XG4gICAgICBkYXRhOiBmb3JtW25hbWVdLmRhdGEsXG4gICAgICBrZXlzOiBfZXh0ZW5kcyh7fSwgZm9ybVtuYW1lXS5rZXlzKVxuICAgIH0sIF9leHRlbmRzMikpIDogX2V4dGVuZHMoe30sIGZvcm0sIChfZXh0ZW5kczMgPSB7fSwgX2V4dGVuZHMzW25hbWVdID0ge1xuICAgICAgZGF0YTogbnVsbCxcbiAgICAgIGtleXM6IHt9XG4gICAgfSwgX2V4dGVuZHMzKSk7XG4gICAgdmFyIGN1cnJlbnQgPSB1cGRhdGVkW25hbWVdO1xuICAgIGZvciAodmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlckxvb3NlKGtleXMpLCBfc3RlcDI7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMigpKS5kb25lOykge1xuICAgICAgdmFyIGtleSA9IF9zdGVwMi52YWx1ZTtcbiAgICAgIGlmIChrZXkgaW4gY3VycmVudC5rZXlzKSB7XG4gICAgICAgIHZhciBfbmFtZSA9IGN1cnJlbnQua2V5c1trZXldO1xuICAgICAgICB2YXIgY29weSA9IHtcbiAgICAgICAgICBkYXRhOiBfbmFtZS5kYXRhLFxuICAgICAgICAgIGtleXM6IF9leHRlbmRzKHt9LCBfbmFtZS5rZXlzKVxuICAgICAgICB9O1xuICAgICAgICBjdXJyZW50LmtleXNba2V5XSA9IGNvcHk7XG4gICAgICAgIGN1cnJlbnQgPSBjb3B5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF9uYW1lMiA9IHtcbiAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgIGtleXM6IHt9XG4gICAgICAgIH07XG4gICAgICAgIGN1cnJlbnQua2V5c1trZXldID0gX25hbWUyO1xuICAgICAgICBjdXJyZW50ID0gX25hbWUyO1xuICAgICAgfVxuICAgIH1cbiAgICBjdXJyZW50LmRhdGEgPSBkYXRhO1xuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG4gIEZvcm1GaWVsZHNVdGlscy5zZXQgPSBzZXQ7XG59KShGb3JtRmllbGRzVXRpbHMgfHwgKEZvcm1GaWVsZHNVdGlscyA9IHt9KSk7XG5cbnZhciBMaXN0RmllbGRzVXRpbHM7XG4oZnVuY3Rpb24gKExpc3RGaWVsZHNVdGlscykge1xuICBmdW5jdGlvbiBjbG9uZShmbG93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwibGlzdFwiLFxuICAgICAgbGlzdDogX2V4dGVuZHMoe30sIGZsb3cubGlzdClcbiAgICB9O1xuICB9XG4gIExpc3RGaWVsZHNVdGlscy5jbG9uZSA9IGNsb25lO1xuICBmdW5jdGlvbiBjcmVhdGVGbG93KCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImxpc3RcIixcbiAgICAgIGxpc3Q6IHt9XG4gICAgfTtcbiAgfVxuICBMaXN0RmllbGRzVXRpbHMuY3JlYXRlRmxvdyA9IGNyZWF0ZUZsb3c7XG4gIGZ1bmN0aW9uIGdldEl0ZW0oZmxvdywgcG9zaXRpb24pIHtcbiAgICB2YXIgaW5kZXggPSBwb3NpdGlvbi5pbmRleDtcbiAgICBpZiAoaW5kZXggaW4gZmxvdy5saXN0KSByZXR1cm4gZmxvdy5saXN0W2luZGV4XTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBMaXN0RmllbGRzVXRpbHMuZ2V0SXRlbSA9IGdldEl0ZW07XG4gIGZ1bmN0aW9uIHNldEl0ZW0oZmxvdywgcG9zaXRpb24sIGl0ZW0pIHtcbiAgICB2YXIgaW5kZXggPSBwb3NpdGlvbi5pbmRleDtcbiAgICBmbG93Lmxpc3RbaW5kZXhdID0gaXRlbTtcbiAgfVxuICBMaXN0RmllbGRzVXRpbHMuc2V0SXRlbSA9IHNldEl0ZW07XG59KShMaXN0RmllbGRzVXRpbHMgfHwgKExpc3RGaWVsZHNVdGlscyA9IHt9KSk7XG5cbnZhciBDb25kRmllbGRzVXRpbHM7XG4oZnVuY3Rpb24gKENvbmRGaWVsZHNVdGlscykge1xuICBmdW5jdGlvbiBjbG9uZShmbG93KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiY29uZFwiLFxuICAgICAgdGhlbjogX2V4dGVuZHMoe30sIGZsb3cudGhlbiksXG4gICAgICBcImVsc2VcIjogX2V4dGVuZHMoe30sIGZsb3dbXCJlbHNlXCJdKVxuICAgIH07XG4gIH1cbiAgQ29uZEZpZWxkc1V0aWxzLmNsb25lID0gY2xvbmU7XG4gIGZ1bmN0aW9uIGNyZWF0ZUZsb3coKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFwiY29uZFwiLFxuICAgICAgdGhlbjoge30sXG4gICAgICBcImVsc2VcIjoge31cbiAgICB9O1xuICB9XG4gIENvbmRGaWVsZHNVdGlscy5jcmVhdGVGbG93ID0gY3JlYXRlRmxvdztcbiAgZnVuY3Rpb24gZ2V0SXRlbShmbG93LCBwb3NpdGlvbikge1xuICAgIHZhciBicmFuY2ggPSBwb3NpdGlvbi5icmFuY2gsXG4gICAgICBpbmRleCA9IHBvc2l0aW9uLmluZGV4O1xuICAgIGlmIChicmFuY2ggaW4gZmxvdykge1xuICAgICAgaWYgKGluZGV4IGluIGZsb3dbYnJhbmNoXSkgcmV0dXJuIGZsb3dbYnJhbmNoXVtpbmRleF07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG4gIENvbmRGaWVsZHNVdGlscy5nZXRJdGVtID0gZ2V0SXRlbTtcbiAgZnVuY3Rpb24gc2V0SXRlbShmbG93LCBwb3NpdGlvbiwgdmFsdWUpIHtcbiAgICB2YXIgX2Zsb3ckYnJhbmNoO1xuICAgIHZhciBicmFuY2ggPSBwb3NpdGlvbi5icmFuY2gsXG4gICAgICBpbmRleCA9IHBvc2l0aW9uLmluZGV4O1xuICAgIGlmIChicmFuY2ggaW4gZmxvdykgZmxvd1ticmFuY2hdW2luZGV4XSA9IHZhbHVlO2Vsc2UgZmxvd1ticmFuY2hdID0gKF9mbG93JGJyYW5jaCA9IHt9LCBfZmxvdyRicmFuY2hbaW5kZXhdID0gdmFsdWUsIF9mbG93JGJyYW5jaCk7XG4gIH1cbiAgQ29uZEZpZWxkc1V0aWxzLnNldEl0ZW0gPSBzZXRJdGVtO1xufSkoQ29uZEZpZWxkc1V0aWxzIHx8IChDb25kRmllbGRzVXRpbHMgPSB7fSkpO1xuXG52YXIgTG9vcEZpZWxkc1V0aWxzO1xuKGZ1bmN0aW9uIChMb29wRmllbGRzVXRpbHMpIHtcbiAgZnVuY3Rpb24gY2xvbmUoZmxvdykge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcImxvb3BcIixcbiAgICAgIGxpc3Q6IF9leHRlbmRzKHt9LCBmbG93Lmxpc3QpXG4gICAgfTtcbiAgfVxuICBMb29wRmllbGRzVXRpbHMuY2xvbmUgPSBjbG9uZTtcbiAgZnVuY3Rpb24gY3JlYXRlRmxvdygpIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZTogXCJsb29wXCIsXG4gICAgICBsaXN0OiB7fVxuICAgIH07XG4gIH1cbiAgTG9vcEZpZWxkc1V0aWxzLmNyZWF0ZUZsb3cgPSBjcmVhdGVGbG93O1xuICBmdW5jdGlvbiBnZXRJdGVtKGZsb3csIHBvc2l0aW9uKSB7XG4gICAgdmFyIGluZGV4ID0gcG9zaXRpb24uaW5kZXg7XG4gICAgaWYgKGluZGV4IGluIGZsb3cubGlzdCkgcmV0dXJuIGZsb3cubGlzdFtpbmRleF07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgTG9vcEZpZWxkc1V0aWxzLmdldEl0ZW0gPSBnZXRJdGVtO1xuICBmdW5jdGlvbiBzZXRJdGVtKGZsb3csIHBvc2l0aW9uLCBpdGVtKSB7XG4gICAgdmFyIGluZGV4ID0gcG9zaXRpb24uaW5kZXg7XG4gICAgZmxvdy5saXN0W2luZGV4XSA9IGl0ZW07XG4gIH1cbiAgTG9vcEZpZWxkc1V0aWxzLnNldEl0ZW0gPSBzZXRJdGVtO1xufSkoTG9vcEZpZWxkc1V0aWxzIHx8IChMb29wRmllbGRzVXRpbHMgPSB7fSkpO1xuXG52YXIgRmxvd0ZpZWxkc1V0aWxzO1xuKGZ1bmN0aW9uIChGbG93RmllbGRzVXRpbHMpIHtcbiAgZnVuY3Rpb24gZ2V0KGZsb3csIHBhdGgsIG5hbWUsIGtleXMsIGRlZmF1bHRWYWx1ZSkge1xuICAgIHZhciBjdXJyZW50ID0gZmxvdztcbiAgICBmb3IgKHZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlckxvb3NlKHBhdGgpLCBfc3RlcDsgIShfc3RlcCA9IF9pdGVyYXRvcigpKS5kb25lOykge1xuICAgICAgdmFyIHBvc2l0aW9uID0gX3N0ZXAudmFsdWU7XG4gICAgICB2YXIgX2Zsb3cgPSBjdXJyZW50O1xuICAgICAgdmFyIGl0ZW0gPSBnZXRJdGVtKF9mbG93LCBwb3NpdGlvbik7XG4gICAgICBpZiAoaXRlbSA9PT0gbnVsbCkgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgICAgIGN1cnJlbnQgPSBpdGVtO1xuICAgIH1cbiAgICB2YXIgZm9ybSA9IGN1cnJlbnQ7XG4gICAgcmV0dXJuIEZvcm1GaWVsZHNVdGlscy5nZXQoZm9ybSwgbmFtZSwga2V5cywgZGVmYXVsdFZhbHVlKTtcbiAgfVxuICBGbG93RmllbGRzVXRpbHMuZ2V0ID0gZ2V0O1xuICBmdW5jdGlvbiBzZXQoZmxvdywgcGF0aCwgbmFtZSwga2V5cywgdmFsdWUpIHtcbiAgICB2YXIgdXBkYXRlZCA9IGNsb25lKGZsb3cpO1xuICAgIHZhciBjdXJyZW50ID0gdXBkYXRlZDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhdGgubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICB2YXIgX3Bvc2l0aW9uID0gcGF0aFtpXTtcbiAgICAgIHZhciBfaXRlbSA9IGdldEl0ZW0oY3VycmVudCwgX3Bvc2l0aW9uKTtcbiAgICAgIGlmIChfaXRlbSkge1xuICAgICAgICB2YXIgbmV4dCA9IF9pdGVtO1xuICAgICAgICB2YXIgY2xvbmVkID0gY2xvbmUobmV4dCk7XG4gICAgICAgIHNldEl0ZW0oY3VycmVudCwgX3Bvc2l0aW9uLCBjbG9uZWQpO1xuICAgICAgICBjdXJyZW50ID0gY2xvbmVkO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIF9uZXh0ID0gY3JlYXRlRmxvdyhwYXRoW2kgKyAxXSk7XG4gICAgICAgIHNldEl0ZW0oY3VycmVudCwgX3Bvc2l0aW9uLCBfbmV4dCk7XG4gICAgICAgIGN1cnJlbnQgPSBfbmV4dDtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHBvc2l0aW9uID0gcGF0aFtwYXRoLmxlbmd0aCAtIDFdO1xuICAgIHZhciBpdGVtID0gZ2V0SXRlbShjdXJyZW50LCBwb3NpdGlvbik7XG4gICAgaWYgKGl0ZW0pIHtcbiAgICAgIHZhciBmb3JtID0gaXRlbTtcbiAgICAgIHNldEl0ZW0oY3VycmVudCwgcG9zaXRpb24sIEZvcm1GaWVsZHNVdGlscy5zZXQoZm9ybSwgbmFtZSwga2V5cywgdmFsdWUpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIF9mb3JtMjtcbiAgICAgIHZhciBfZm9ybSA9IChfZm9ybTIgPSB7fSwgX2Zvcm0yW25hbWVdID0ge1xuICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICBrZXlzOiB7fVxuICAgICAgfSwgX2Zvcm0yKTtcbiAgICAgIHNldEl0ZW0oY3VycmVudCwgcG9zaXRpb24sIEZvcm1GaWVsZHNVdGlscy5zZXQoX2Zvcm0sIG5hbWUsIGtleXMsIHZhbHVlKSk7XG4gICAgfVxuICAgIHJldHVybiB1cGRhdGVkO1xuICB9XG4gIEZsb3dGaWVsZHNVdGlscy5zZXQgPSBzZXQ7XG4gIHZhciBjbG9uZSA9IC8qI19fUFVSRV9fKi9tYXBzeShbXSwgW1widHlwZVwiXSwge1xuICAgIGxpc3Q6IExpc3RGaWVsZHNVdGlscy5jbG9uZSxcbiAgICBjb25kOiBDb25kRmllbGRzVXRpbHMuY2xvbmUsXG4gICAgbG9vcDogTG9vcEZpZWxkc1V0aWxzLmNsb25lXG4gIH0pO1xuICB2YXIgY3JlYXRlRmxvdyA9IC8qI19fUFVSRV9fKi9tYXBzeShbXSwgW1widHlwZVwiXSwge1xuICAgIGxpc3Q6IExpc3RGaWVsZHNVdGlscy5jcmVhdGVGbG93LFxuICAgIGNvbmQ6IENvbmRGaWVsZHNVdGlscy5jcmVhdGVGbG93LFxuICAgIGxvb3A6IExvb3BGaWVsZHNVdGlscy5jcmVhdGVGbG93XG4gIH0pO1xuICB2YXIgZ2V0SXRlbSA9IC8qI19fUFVSRV9fKi9tYXBzeShbXSwgW1widHlwZVwiXSwge1xuICAgIGxpc3Q6IExpc3RGaWVsZHNVdGlscy5nZXRJdGVtLFxuICAgIGNvbmQ6IENvbmRGaWVsZHNVdGlscy5nZXRJdGVtLFxuICAgIGxvb3A6IExvb3BGaWVsZHNVdGlscy5nZXRJdGVtXG4gIH0pO1xuICB2YXIgc2V0SXRlbSA9IC8qI19fUFVSRV9fKi9tYXBzeShbXSwgW1widHlwZVwiXSwge1xuICAgIGxpc3Q6IExpc3RGaWVsZHNVdGlscy5zZXRJdGVtLFxuICAgIGNvbmQ6IENvbmRGaWVsZHNVdGlscy5zZXRJdGVtLFxuICAgIGxvb3A6IExvb3BGaWVsZHNVdGlscy5zZXRJdGVtXG4gIH0pO1xufSkoRmxvd0ZpZWxkc1V0aWxzIHx8IChGbG93RmllbGRzVXRpbHMgPSB7fSkpO1xuXG52YXIgQ29udHJvbGxlciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbnRyb2xsZXIoc2NoZW1hKSB7XG4gICAgdGhpcy5zY2hlbWEgPSBzY2hlbWE7XG4gIH1cbiAgdmFyIF9wcm90byA9IENvbnRyb2xsZXIucHJvdG90eXBlO1xuICBfcHJvdG8uaW5pdGlhbCA9IGZ1bmN0aW9uIGluaXRpYWwodmFyaWFibGVzKSB7XG4gICAgaWYgKHZhcmlhYmxlcyA9PT0gdm9pZCAwKSB7XG4gICAgICB2YXJpYWJsZXMgPSB7fTtcbiAgICB9XG4gICAgdmFyIHBhdGggPSB0aGlzLmluaXRpYWxQYXRoKCk7XG4gICAgdmFyIHN0b3AgPSB0aGlzLm5lYXJlc3RTdG9wUG9pbnQoe1xuICAgICAgcGF0aDogcGF0aCxcbiAgICAgIHZhcmlhYmxlczogdmFyaWFibGVzXG4gICAgfSk7XG4gICAgdmFyIGZpZWxkcyA9IHtcbiAgICAgIHR5cGU6IFwibGlzdFwiLFxuICAgICAgbGlzdDoge31cbiAgICB9O1xuICAgIHJldHVybiB7XG4gICAgICBwb2ludHM6IFtzdG9wXSxcbiAgICAgIGZpZWxkczogZmllbGRzXG4gICAgfTtcbiAgfTtcbiAgX3Byb3RvLmluaXRpYWxQYXRoID0gZnVuY3Rpb24gaW5pdGlhbFBhdGgoKSB7XG4gICAgdmFyIHBhdGggPSB0aGlzLmluaXRpYWxQYXRoU2NoZW1hKHRoaXMuc2NoZW1hKTtcbiAgICBpZiAocGF0aCkgcmV0dXJuIHBhdGg7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiVGhlIHNjaGVtYSBpcyBtYWxmb3JtZWRcIik7XG4gIH07XG4gIF9wcm90by5pbml0aWFsUGF0aFNjaGVtYSA9IGZ1bmN0aW9uIGluaXRpYWxQYXRoU2NoZW1hKHNjaGVtYSkge1xuICAgIHZhciBwb3NpdGlvbiA9IEZsb3dTY2hlbWFVdGlscy5pbnRvKHNjaGVtYSwge30pO1xuICAgIHdoaWxlIChwb3NpdGlvbikge1xuICAgICAgdmFyIHBhdGggPSB0aGlzLmluaXRpYWxQYXRoUG9zaXRpb24oc2NoZW1hLCBwb3NpdGlvbik7XG4gICAgICBpZiAocGF0aCkgcmV0dXJuIHBhdGg7XG4gICAgICBwb3NpdGlvbiA9IEZsb3dTY2hlbWFVdGlscy5uZXh0KHNjaGVtYSwgcG9zaXRpb24sIHt9KTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG4gIF9wcm90by5pbml0aWFsUGF0aFBvc2l0aW9uID0gZnVuY3Rpb24gaW5pdGlhbFBhdGhQb3NpdGlvbihzY2hlbWEsIHBvc2l0aW9uKSB7XG4gICAgdmFyIGl0ZW0gPSBGbG93U2NoZW1hVXRpbHMuZmluZChzY2hlbWEsIFtwb3NpdGlvbl0pO1xuICAgIGlmIChGbG93U2NoZW1hVXRpbHMuaXMoaXRlbSkpIHtcbiAgICAgIHZhciBwYXRoID0gdGhpcy5pbml0aWFsUGF0aFNjaGVtYShpdGVtKTtcbiAgICAgIGlmIChwYXRoKSByZXR1cm4gW3Bvc2l0aW9uXS5jb25jYXQocGF0aCk7ZWxzZSByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIFtwb3NpdGlvbl07XG4gIH07XG4gIF9wcm90by5uZWFyZXN0U3RvcFBvaW50ID0gZnVuY3Rpb24gbmVhcmVzdFN0b3BQb2ludChwb2ludCkge1xuICAgIHZhciBjdXJyZW50ID0gcG9pbnQ7XG4gICAgd2hpbGUgKFZhcmlhYmxlc1NjaGVtYVV0aWxzLmlzKEZsb3dTY2hlbWFVdGlscy5maW5kKHRoaXMuc2NoZW1hLCBjdXJyZW50LnBhdGgpKSkge1xuICAgICAgdmFyIHNjaGVtYSA9IEZsb3dTY2hlbWFVdGlscy5maW5kKHRoaXMuc2NoZW1hLCBjdXJyZW50LnBhdGgpO1xuICAgICAgdmFyIHZhcmlhYmxlcyA9IFZhcmlhYmxlc1NjaGVtYVV0aWxzLnZhcmlhYmxlcyhzY2hlbWEsIGN1cnJlbnQudmFyaWFibGVzKTtcbiAgICAgIGN1cnJlbnQgPSB7XG4gICAgICAgIHBhdGg6IGN1cnJlbnQucGF0aCxcbiAgICAgICAgdmFyaWFibGVzOiBfZXh0ZW5kcyh7fSwgY3VycmVudC52YXJpYWJsZXMsIHZhcmlhYmxlcylcbiAgICAgIH07XG4gICAgICBjdXJyZW50ID0gdGhpcy5uZXh0UG9pbnQoY3VycmVudCk7XG4gICAgfVxuICAgIHJldHVybiBjdXJyZW50O1xuICB9O1xuICBfcHJvdG8ubmV4dFBvaW50ID0gZnVuY3Rpb24gbmV4dFBvaW50KHBvaW50KSB7XG4gICAgdmFyIHNlbGVjdGVkID0gdGhpcy5uZXh0Rmxvd1BvaW50KHBvaW50KTtcbiAgICBpZiAoc2VsZWN0ZWQpIHJldHVybiBzZWxlY3RlZDtcbiAgICByZXR1cm4gdGhpcy5uZXh0UG9pbnQodGhpcy5wYXJlbnRQb2ludChwb2ludCkpO1xuICB9O1xuICBfcHJvdG8ubmV4dEZsb3dQb2ludCA9IGZ1bmN0aW9uIG5leHRGbG93UG9pbnQocG9pbnQpIHtcbiAgICB2YXIgbmV4dCA9IHRoaXMubmV4dEZsb3dQb2ludE5leHQocG9pbnQpO1xuICAgIGlmIChuZXh0KSB7XG4gICAgICB2YXIgaW50byA9IHRoaXMubmV4dEZsb3dQb2ludEludG8obmV4dCk7XG4gICAgICBpZiAoaW50bykgcmV0dXJuIGludG87XG4gICAgICByZXR1cm4gdGhpcy5uZXh0Rmxvd1BvaW50KG5leHQpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcbiAgX3Byb3RvLm5leHRGbG93UG9pbnROZXh0ID0gZnVuY3Rpb24gbmV4dEZsb3dQb2ludE5leHQocG9pbnQpIHtcbiAgICB2YXIgZmxvdyA9IEZsb3dTY2hlbWFVdGlscy5maW5kKHRoaXMuc2NoZW1hLCBwb2ludC5wYXRoLnNsaWNlKDAsIC0xKSk7XG4gICAgdmFyIHBvc2l0aW9uID0gRmxvd1NjaGVtYVV0aWxzLm5leHQoZmxvdywgcG9pbnQucGF0aFtwb2ludC5wYXRoLmxlbmd0aCAtIDFdLCBwb2ludC52YXJpYWJsZXMpO1xuICAgIGlmIChwb3NpdGlvbikge1xuICAgICAgdmFyIHBhdGggPSBbXS5jb25jYXQocG9pbnQucGF0aC5zbGljZSgwLCAtMSksIFtwb3NpdGlvbl0pO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGF0aDogcGF0aCxcbiAgICAgICAgdmFyaWFibGVzOiBwb2ludC52YXJpYWJsZXNcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9O1xuICBfcHJvdG8ubmV4dEZsb3dQb2ludEludG8gPSBmdW5jdGlvbiBuZXh0Rmxvd1BvaW50SW50byhwb2ludCkge1xuICAgIHZhciBpdGVtID0gRmxvd1NjaGVtYVV0aWxzLmZpbmQodGhpcy5zY2hlbWEsIHBvaW50LnBhdGgpO1xuICAgIGlmIChGbG93U2NoZW1hVXRpbHMuaXMoaXRlbSkpIHtcbiAgICAgIHZhciBwb3NpdGlvbiA9IEZsb3dTY2hlbWFVdGlscy5pbnRvKGl0ZW0sIHBvaW50LnZhcmlhYmxlcyk7XG4gICAgICBpZiAocG9zaXRpb24pIHtcbiAgICAgICAgdmFyIHBhdGggPSBbXS5jb25jYXQocG9pbnQucGF0aCwgW3Bvc2l0aW9uXSk7XG4gICAgICAgIHZhciBuZXh0ID0ge1xuICAgICAgICAgIHBhdGg6IHBhdGgsXG4gICAgICAgICAgdmFyaWFibGVzOiBwb2ludC52YXJpYWJsZXNcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIGludG8gPSB0aGlzLm5leHRGbG93UG9pbnRJbnRvKG5leHQpO1xuICAgICAgICBpZiAoaW50bykgcmV0dXJuIGludG87XG4gICAgICAgIHJldHVybiB0aGlzLm5leHRGbG93UG9pbnQobmV4dCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHBvaW50O1xuICB9O1xuICBfcHJvdG8ucGFyZW50UG9pbnQgPSBmdW5jdGlvbiBwYXJlbnRQb2ludChwb2ludCkge1xuICAgIGlmIChwb2ludC5wYXRoLmxlbmd0aCA+IDEpIHJldHVybiB7XG4gICAgICBwYXRoOiBwb2ludC5wYXRoLnNsaWNlKDAsIC0xKSxcbiAgICAgIHZhcmlhYmxlczogcG9pbnQudmFyaWFibGVzXG4gICAgfTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc2NoZW1hIGlzIG1hbGZvcm1lZFwiKTtcbiAgfTtcbiAgX3Byb3RvLm5leHQgPSBmdW5jdGlvbiBuZXh0KGZsb3csIGZvcm1EYXRhKSB7XG4gICAgdmFyIGZpZWxkcyA9IHRoaXMudXBkYXRlRmllbGRzKGZsb3csIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gdGhpcy5uYXZpZ2F0ZU5leHQoZmxvdywgZmllbGRzLCBmb3JtRGF0YSk7XG4gIH07XG4gIF9wcm90by51cGRhdGVGaWVsZHMgPSBmdW5jdGlvbiB1cGRhdGVGaWVsZHMoZmxvdywgZm9ybURhdGEpIHtcbiAgICB2YXIgc3RvcCA9IGZsb3cucG9pbnRzW2Zsb3cucG9pbnRzLmxlbmd0aCAtIDFdO1xuICAgIHZhciBmb3JtID0gRmxvd1NjaGVtYVV0aWxzLmZpbmQodGhpcy5zY2hlbWEsIHN0b3AucGF0aCk7XG4gICAgdmFyIGtleXMgPSBGb3JtU2NoZW1hVXRpbHMua2V5cyhmb3JtLCBzdG9wLnZhcmlhYmxlcyk7XG4gICAgdmFyIGZpZWxkcyA9IGZsb3cuZmllbGRzO1xuICAgIGZvciAodmFyIF9pID0gMCwgX09iamVjdCRlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoZm9ybURhdGEpOyBfaSA8IF9PYmplY3QkZW50cmllcy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBfT2JqZWN0JGVudHJpZXMkX2kgPSBfT2JqZWN0JGVudHJpZXNbX2ldLFxuICAgICAgICBuYW1lID0gX09iamVjdCRlbnRyaWVzJF9pWzBdLFxuICAgICAgICB2YWx1ZSA9IF9PYmplY3QkZW50cmllcyRfaVsxXTtcbiAgICAgIGZpZWxkcyA9IEZsb3dGaWVsZHNVdGlscy5zZXQoZmllbGRzLCBzdG9wLnBhdGgsIG5hbWUsIGtleXMobmFtZSksIHZhbHVlKTtcbiAgICB9XG4gICAgcmV0dXJuIGZpZWxkcztcbiAgfTtcbiAgX3Byb3RvLm5hdmlnYXRlTmV4dCA9IGZ1bmN0aW9uIG5hdmlnYXRlTmV4dChmbG93LCBmaWVsZHMsIGZvcm1EYXRhKSB7XG4gICAgdmFyIGxhc3QgPSBmbG93LnBvaW50c1tmbG93LnBvaW50cy5sZW5ndGggLSAxXTtcbiAgICB2YXIgdmFycyA9IF9leHRlbmRzKHt9LCBsYXN0LnZhcmlhYmxlcywgZm9ybURhdGEpO1xuICAgIHZhciBuZXh0ID0gdGhpcy5uZWFyZXN0U3RvcFBvaW50KHRoaXMubmV4dFBvaW50KHtcbiAgICAgIHBhdGg6IGxhc3QucGF0aCxcbiAgICAgIHZhcmlhYmxlczogdmFyc1xuICAgIH0pKTtcbiAgICByZXR1cm4ge1xuICAgICAgcG9pbnRzOiBbXS5jb25jYXQoZmxvdy5wb2ludHMsIFtuZXh0XSksXG4gICAgICBmaWVsZHM6IGZpZWxkc1xuICAgIH07XG4gIH07XG4gIF9wcm90by5wcmV2aW91cyA9IGZ1bmN0aW9uIHByZXZpb3VzKGZsb3csIGZvcm1EYXRhKSB7XG4gICAgdmFyIGZpZWxkcyA9IHRoaXMudXBkYXRlRmllbGRzKGZsb3csIGZvcm1EYXRhKTtcbiAgICByZXR1cm4gdGhpcy5uYXZpZ2F0ZVByZXZpb3VzKGZsb3csIGZpZWxkcyk7XG4gIH07XG4gIF9wcm90by5uYXZpZ2F0ZVByZXZpb3VzID0gZnVuY3Rpb24gbmF2aWdhdGVQcmV2aW91cyhmbG93LCBmaWVsZHMpIHtcbiAgICB2YXIgcHJldiA9IGZsb3cucG9pbnRzLnNsaWNlKDAsIC0xKTtcbiAgICByZXR1cm4ge1xuICAgICAgcG9pbnRzOiBwcmV2LFxuICAgICAgZmllbGRzOiBmaWVsZHNcbiAgICB9O1xuICB9O1xuICByZXR1cm4gQ29udHJvbGxlcjtcbn0oKTtcblxuZnVuY3Rpb24gdXNlRGVmYXVsdFZhbHVlcyhmb3JtLCBwYXRoLCBmaWVsZHMpIHtcbiAgcmV0dXJuIHVzZU1lbW8oZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBPYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXMoZm9ybS5kZWZhdWx0VmFsdWVzKS5tYXAoZnVuY3Rpb24gKF9yZWYpIHtcbiAgICAgIHZhciBuYW1lID0gX3JlZlswXSxcbiAgICAgICAgX3JlZiQgPSBfcmVmWzFdLFxuICAgICAgICB2YWx1ZSA9IF9yZWYkWzBdLFxuICAgICAgICBrZXlzID0gX3JlZiRbMV07XG4gICAgICByZXR1cm4gW25hbWUsIEZsb3dGaWVsZHNVdGlscy5nZXQoZmllbGRzLCBwYXRoLCBuYW1lLCBrZXlzLCB2YWx1ZSldO1xuICAgIH0pKTtcbiAgfSwgW2Zvcm0sIHBhdGgsIGZpZWxkc10pO1xufVxuXG5mdW5jdGlvbiB1c2VSZXNvbHZlcihmb3JtKSB7XG4gIHJldHVybiB1c2VNZW1vKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKHZhbHVlcykge1xuICAgICAgdmFyIGVycm9ycyA9IHt9O1xuICAgICAgZm9yICh2YXIgX2kgPSAwLCBfT2JqZWN0JGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhmb3JtLnJlc29sdmVyKTsgX2kgPCBfT2JqZWN0JGVudHJpZXMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHZhciBfT2JqZWN0JGVudHJpZXMkX2kgPSBfT2JqZWN0JGVudHJpZXNbX2ldLFxuICAgICAgICAgIG5hbWUgPSBfT2JqZWN0JGVudHJpZXMkX2lbMF0sXG4gICAgICAgICAgdmFsaWRhdGlvbnMgPSBfT2JqZWN0JGVudHJpZXMkX2lbMV07XG4gICAgICAgIHZhciBlcnJvciA9IHZhbGlkYXRpb25zLmZpbmQoZnVuY3Rpb24gKF9yZWYpIHtcbiAgICAgICAgICB2YXIgZXhwciA9IF9yZWZbMF07XG4gICAgICAgICAgcmV0dXJuICFleHByeShleHByLCB2YWx1ZXMpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGVycm9yKSBlcnJvcnNbbmFtZV0gPSB7XG4gICAgICAgICAgdHlwZTogXCJ2YWxpZGF0aW9uXCIsXG4gICAgICAgICAgbWVzc2FnZTogZXJyb3JbMV1cbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlczogdmFsdWVzLFxuICAgICAgICBlcnJvcnM6IGVycm9yc1xuICAgICAgfTtcbiAgICB9O1xuICB9LCBbZm9ybV0pO1xufVxuXG5mdW5jdGlvbiB1c2VSZW5kZXIoZm9ybSwgdmFyaWFibGVzLCBjb21wb25lbnRzKSB7XG4gIHJldHVybiB1c2VNZW1vKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbiBjYWxsYmFjayh2YWx1ZSkge1xuICAgICAgdmFyIG9iamVjdCA9IHZhbHVlO1xuICAgICAgdmFyIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCksXG4gICAgICAgIGtleSA9IF9PYmplY3Qka2V5c1swXTtcbiAgICAgIHZhciBjb21wb25lbnQgPSBjb21wb25lbnRzW2tleV07XG4gICAgICB2YXIgdmFsdWVzID0gb2JqZWN0W2tleV07XG4gICAgICByZXR1cm4gY29tcG9uZW50KHZhbHVlcywgY2FsbGJhY2spO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICAgIHZhciByZW5kZXIgPSBleHByeShmb3JtLnJlbmRlciwgX2V4dGVuZHMoe30sIHZhcmlhYmxlcywgdmFsdWVzKSk7XG4gICAgICByZXR1cm4gY2FsbGJhY2socmVuZGVyKTtcbiAgICB9O1xuICB9LCBbZm9ybSwgdmFyaWFibGVzLCBjb21wb25lbnRzXSk7XG59XG5cbnZhciBGb3JtaXR5Q29udGV4dCA9IC8qI19fUFVSRV9fKi9jcmVhdGVDb250ZXh0KG51bGwpO1xuZnVuY3Rpb24gdXNlRm9ybWl0eSgpIHtcbiAgdmFyIGNvbnRleHQgPSB1c2VDb250ZXh0KEZvcm1pdHlDb250ZXh0KTtcbiAgaWYgKCFjb250ZXh0KSB0aHJvdyBuZXcgRXJyb3IoXCJ1c2VGb3JtaXR5IG11c3QgYmUgdXNlZCB3aXRoaW4gRm9ybWl0eVwiKTtcbiAgcmV0dXJuIGNvbnRleHQ7XG59XG5cbnZhciBSZXR1cm5TY2hlbWFVdGlscztcbihmdW5jdGlvbiAoUmV0dXJuU2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIFwicmV0dXJuXCIgaW4gc2NoZW1hO1xuICB9XG4gIFJldHVyblNjaGVtYVV0aWxzLmlzID0gaXM7XG4gIGZ1bmN0aW9uIHJlc3VsdChzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcInJldHVyblwiLFxuICAgICAgXCJyZXR1cm5cIjogZXhwcnkoc2NoZW1hW1wicmV0dXJuXCJdLCB2YXJpYWJsZXMpXG4gICAgfTtcbiAgfVxuICBSZXR1cm5TY2hlbWFVdGlscy5yZXN1bHQgPSByZXN1bHQ7XG59KShSZXR1cm5TY2hlbWFVdGlscyB8fCAoUmV0dXJuU2NoZW1hVXRpbHMgPSB7fSkpO1xuXG52YXIgU3RlcFNjaGVtYVV0aWxzO1xuKGZ1bmN0aW9uIChTdGVwU2NoZW1hVXRpbHMpIHtcbiAgZnVuY3Rpb24gaXMoc2NoZW1hKSB7XG4gICAgcmV0dXJuIEZvcm1TY2hlbWFVdGlscy5pcyhzY2hlbWEpIHx8IFJldHVyblNjaGVtYVV0aWxzLmlzKHNjaGVtYSk7XG4gIH1cbiAgU3RlcFNjaGVtYVV0aWxzLmlzID0gaXM7XG4gIGZ1bmN0aW9uIHJlc3VsdChzY2hlbWEsIHZhcmlhYmxlcykge1xuICAgIGlmIChGb3JtU2NoZW1hVXRpbHMuaXMoc2NoZW1hKSkgcmV0dXJuIEZvcm1TY2hlbWFVdGlscy5yZXN1bHQoc2NoZW1hLCB2YXJpYWJsZXMpO1xuICAgIGlmIChSZXR1cm5TY2hlbWFVdGlscy5pcyhzY2hlbWEpKSByZXR1cm4gUmV0dXJuU2NoZW1hVXRpbHMucmVzdWx0KHNjaGVtYSwgdmFyaWFibGVzKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHNjaGVtYVwiKTtcbiAgfVxuICBTdGVwU2NoZW1hVXRpbHMucmVzdWx0ID0gcmVzdWx0O1xufSkoU3RlcFNjaGVtYVV0aWxzIHx8IChTdGVwU2NoZW1hVXRpbHMgPSB7fSkpO1xuXG52YXIgRmxvd1V0aWxzO1xuKGZ1bmN0aW9uIChGbG93VXRpbHMpIHtcbiAgZnVuY3Rpb24gZ2V0UmVzdWx0KGZsb3csIHNjaGVtYSkge1xuICAgIHZhciBfZmxvdyRwb2ludHMgPSBmbG93LnBvaW50c1tmbG93LnBvaW50cy5sZW5ndGggLSAxXSxcbiAgICAgIHBhdGggPSBfZmxvdyRwb2ludHMucGF0aCxcbiAgICAgIHZhcmlhYmxlcyA9IF9mbG93JHBvaW50cy52YXJpYWJsZXM7XG4gICAgdmFyIG5lc3RlZCA9IEZsb3dTY2hlbWFVdGlscy5maW5kKHNjaGVtYSwgcGF0aCk7XG4gICAgcmV0dXJuIFN0ZXBTY2hlbWFVdGlscy5yZXN1bHQobmVzdGVkLCB2YXJpYWJsZXMpO1xuICB9XG4gIEZsb3dVdGlscy5nZXRSZXN1bHQgPSBnZXRSZXN1bHQ7XG4gIGZ1bmN0aW9uIGdldEZsb3coZmxvdywgc2NoZW1hLCBmb3JtRGF0YSkge1xuICAgIHZhciBzdG9wID0gZmxvdy5wb2ludHNbZmxvdy5wb2ludHMubGVuZ3RoIC0gMV07XG4gICAgdmFyIHBhdGggPSBzdG9wLnBhdGg7XG4gICAgdmFyIHZhcmlhYmxlcyA9IHN0b3AudmFyaWFibGVzO1xuICAgIHZhciBmb3JtID0gRmxvd1NjaGVtYVV0aWxzLmZpbmQoc2NoZW1hLCBwYXRoKTtcbiAgICB2YXIga2V5cyA9IEZvcm1TY2hlbWFVdGlscy5rZXlzKGZvcm0sIHZhcmlhYmxlcyk7XG4gICAgdmFyIGZpZWxkcyA9IGZsb3cuZmllbGRzO1xuICAgIGZvciAodmFyIF9pID0gMCwgX09iamVjdCRlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoZm9ybURhdGEpOyBfaSA8IF9PYmplY3QkZW50cmllcy5sZW5ndGg7IF9pKyspIHtcbiAgICAgIHZhciBfT2JqZWN0JGVudHJpZXMkX2kgPSBfT2JqZWN0JGVudHJpZXNbX2ldLFxuICAgICAgICBuYW1lID0gX09iamVjdCRlbnRyaWVzJF9pWzBdLFxuICAgICAgICB2YWx1ZSA9IF9PYmplY3QkZW50cmllcyRfaVsxXTtcbiAgICAgIGZpZWxkcyA9IEZsb3dGaWVsZHNVdGlscy5zZXQoZmllbGRzLCBwYXRoLCBuYW1lLCBrZXlzKG5hbWUpLCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBfZXh0ZW5kcyh7fSwgZmxvdywge1xuICAgICAgZmllbGRzOiBmaWVsZHNcbiAgICB9KTtcbiAgfVxuICBGbG93VXRpbHMuZ2V0RmxvdyA9IGdldEZsb3c7XG59KShGbG93VXRpbHMgfHwgKEZsb3dVdGlscyA9IHt9KSk7XG5cbmZ1bmN0aW9uIEZvcm1pdHkoX3JlZikge1xuICB2YXIgY29tcG9uZW50cyA9IF9yZWYuY29tcG9uZW50cyxcbiAgICB2YXJpYWJsZXMgPSBfcmVmLnZhcmlhYmxlcyxcbiAgICBzY2hlbWEgPSBfcmVmLnNjaGVtYSxcbiAgICBvblJldHVybiA9IF9yZWYub25SZXR1cm4sXG4gICAgaW5pdGlhbEZsb3cgPSBfcmVmLmluaXRpYWxGbG93O1xuICB2YXIgY29udHJvbGxlciA9IHVzZU1lbW8oZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBuZXcgQ29udHJvbGxlcihzY2hlbWEpO1xuICB9LCBbc2NoZW1hXSk7XG4gIHZhciBfdXNlU3RhdGUgPSB1c2VTdGF0ZShmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoaW5pdGlhbEZsb3cpIHJldHVybiBpbml0aWFsRmxvdztcbiAgICAgIHJldHVybiBjb250cm9sbGVyLmluaXRpYWwodmFyaWFibGVzKTtcbiAgICB9KSxcbiAgICBmbG93ID0gX3VzZVN0YXRlWzBdLFxuICAgIHNldEZsb3cgPSBfdXNlU3RhdGVbMV07XG4gIHZhciBmb3JtID0gRmxvd1V0aWxzLmdldFJlc3VsdChmbG93LCBzY2hlbWEpO1xuICB2YXIgaGFuZGxlTmV4dCA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uIChmb3JtRGF0YSkge1xuICAgIHZhciBuZXh0ID0gY29udHJvbGxlci5uZXh0KGZsb3csIGZvcm1EYXRhKTtcbiAgICB2YXIgcmVzdWx0ID0gRmxvd1V0aWxzLmdldFJlc3VsdChuZXh0LCBzY2hlbWEpO1xuICAgIGlmIChyZXN1bHQudHlwZSA9PT0gXCJyZXR1cm5cIikgb25SZXR1cm4ocmVzdWx0W1wicmV0dXJuXCJdLCBfZXh0ZW5kcyh7fSwgZmxvdywge1xuICAgICAgZmllbGRzOiBuZXh0LmZpZWxkc1xuICAgIH0pKTtlbHNlIHNldEZsb3cobmV4dCk7XG4gIH0sIFtjb250cm9sbGVyLCBmbG93LCBvblJldHVybl0pO1xuICB2YXIgaGFuZGxlQmFjayA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uIChmb3JtRGF0YSkge1xuICAgIHZhciBwcmV2aW91cyA9IGNvbnRyb2xsZXIucHJldmlvdXMoZmxvdywgZm9ybURhdGEpO1xuICAgIHNldEZsb3cocHJldmlvdXMpO1xuICB9LCBbY29udHJvbGxlciwgZmxvd10pO1xuICB2YXIgZ2V0RmxvdyA9IHVzZUNhbGxiYWNrKGZ1bmN0aW9uIChmb3JtRGF0YSkge1xuICAgIHJldHVybiBGbG93VXRpbHMuZ2V0RmxvdyhmbG93LCBzY2hlbWEsIGZvcm1EYXRhKTtcbiAgfSwgW2Zsb3csIHNjaGVtYV0pO1xuICB2YXIgcG9pbnQgPSBmbG93LnBvaW50c1tmbG93LnBvaW50cy5sZW5ndGggLSAxXTtcbiAgdmFyIGRlZmF1bHRWYWx1ZXMgPSB1c2VEZWZhdWx0VmFsdWVzKGZvcm0sIHBvaW50LnBhdGgsIGZsb3cuZmllbGRzKTtcbiAgdmFyIHJlc29sdmVyID0gdXNlUmVzb2x2ZXIoZm9ybSk7XG4gIHZhciByZW5kZXIgPSB1c2VSZW5kZXIoZm9ybSwgcG9pbnQudmFyaWFibGVzLCBjb21wb25lbnRzKTtcbiAgdmFyIHZhbHVlcyA9IHVzZU1lbW8oZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdGVwOiBmbG93LnBvaW50cy5sZW5ndGgsXG4gICAgICBkZWZhdWx0VmFsdWVzOiBkZWZhdWx0VmFsdWVzLFxuICAgICAgcmVzb2x2ZXI6IHJlc29sdmVyLFxuICAgICAgb25OZXh0OiBoYW5kbGVOZXh0LFxuICAgICAgb25CYWNrOiBoYW5kbGVCYWNrLFxuICAgICAgZ2V0RmxvdzogZ2V0Rmxvd1xuICAgIH07XG4gIH0sIFtmbG93LnBvaW50cy5sZW5ndGgsIGRlZmF1bHRWYWx1ZXMsIHJlc29sdmVyLCBoYW5kbGVOZXh0LCBoYW5kbGVCYWNrLCBnZXRGbG93XSk7XG4gIHJldHVybiBjcmVhdGVFbGVtZW50KEZvcm1pdHlDb250ZXh0LlByb3ZpZGVyLCB7XG4gICAgdmFsdWU6IHZhbHVlc1xuICB9LCByZW5kZXIodmFsdWVzKSk7XG59XG5cbmV4cG9ydCB7IEZvcm1pdHksIHVzZUZvcm1pdHkgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWZvcm1pdHkuZXNtLmpzLm1hcFxuIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/formity/dist/formity.esm.js\n");

/***/ })

};
;